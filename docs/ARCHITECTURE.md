# FastBlog 系统架构文档

## 📋 文档信息

**版本**：v2.1.0  
**更新时间**：2026年2月

## 🏗️ 核心架构模式

FastBlog采用**进程监督器模式**和**前后端分离架构**，确保系统的高可靠性和可扩展性。

### 进程监督器架构

```
┌─────────────────────────────────────────┐
│           SupervisedLauncher            │ ◄─ 主监督器
└─────────────────┬───────────────────────┘
                  │
                  ▼
        ┌─────────────────┐
        │ ProcessSupervisor │ ◄─ 进程监督核心
        └────────┬────────┘
                 │
        ┌────────┴────────┬───────────────┬───────────────┐
        ▼                 ▼               ▼               ▼
┌─────────────┐   ┌──────────────┐  ┌──────────┐  ┌──────────┐
│ IPC Server  │   │ UpdateChecker│  │ Main App │  │ Updater  │
│ (端口:12345)│   │ (端口:8001)  │  │(端口:9421)│  │ (按需)   │
└─────────────┘   └──────────────┘  └──────────┘  └──────────┘
```

**核心优势**：
- 高可靠性：自动故障检测和恢复
- 进程隔离：组件独立运行
- 统一管理：集中生命周期控制
- 安全更新：独立的文件更新机制

### 启动模式对比

| 模式 | 命令 | 适用场景 | 特点 |
|------|------|----------|------|
| App模式 | `python main.py` | 开发调试 | 直接启动，轻量级 |
| Supervisor模式 | `python main.py --mode supervisor` | 生产环境 | 进程监督，自动重启 |

## 📐 系统架构图

### 前后端分离架构
```
用户端 ↔ 负载均衡(Nginx) ↔ 前端(Next.js:3000) ↔ 后端(FastAPI:9421) ↔ 数据库(PostgreSQL)
                                      ↓
                                  缓存(Redis)
```

### 后端服务架构
```
src/
├── api/v1/           # REST API接口
├── models/           # 数据模型
├── services/         # 业务逻辑
├── utils/            # 工具函数
└── middleware/       # 中间件
```

### 前端架构
```
frontend-next/
├── app/              # 路由页面
├── components/       # UI组件
├── hooks/            # 自定义Hooks
└── lib/              # 工具库
```

## 🔧 核心组件

### 1. 进程管理组件
- **SupervisedLauncher**: 主启动器和监督器
- **ProcessSupervisor**: 进程生命周期管理
- **IPC Server**: 进程间通信服务
- **UpdateChecker**: 版本检查服务

### 2. 业务组件
- **Main App**: 核心业务逻辑 (FastAPI)
- **Frontend**: 用户界面 (Next.js)
- **Database**: 数据存储 (PostgreSQL)
- **Cache**: 缓存服务 (Redis)

## 🛡️ 安全架构

### 多层安全防护
- **认证授权**: JWT Token + RBAC权限控制
- **输入验证**: 参数校验和SQL注入防护
- **传输安全**: HTTPS/TLS 1.3加密
- **访问控制**: 细粒度权限管理

### 安全特性
```
应用层: JWT认证 | RBAC | CSRF防护 | XSS过滤
传输层: HTTPS | TLS 1.3 | HSTS
数据层: 数据库加密 | 参数化查询 | 访问日志
```

## 📊 数据流向

```
用户请求 → 负载均衡 → 前端渲染 → API网关 → 业务处理 → 数据库
   ↑         ↑          ↑         ↑          ↑          ↑
响应返回 ← CDN缓存 ← React组件 ← API响应 ← 服务层 ← 查询结果
```

## 🛠️ 技术栈

### 前端
- **框架**: Next.js 14 (App Router)
- **语言**: TypeScript
- **样式**: TailwindCSS + shadcn/ui
- **状态**: React Context + SWR

### 后端
- **框架**: FastAPI
- **语言**: Python 3.14+
- **数据库**: PostgreSQL 17+
- **缓存**: Redis

### 基础设施
- **容器化**: Docker + Docker Compose
- **部署**: Nginx + Gunicorn
- **监控**: Prometheus + Grafana

## 📚 架构决策

### 为什么选择进程监督器？
1. **可靠性**: 自动故障恢复机制
2. **隔离性**: 进程间相互独立
3. **可管理性**: 统一的进程控制
4. **可扩展性**: 易于添加新组件

### 为什么选择前后端分离？
1. **专业化**: 前后端独立开发
2. **性能**: 前端静态化，后端API化
3. **扩展性**: 支持多端接入
4. **维护性**: 职责清晰，便于维护

---
*文档版本：v2.1.0 | 更新时间：2026年2月*